<!DOCTYPE html>
<html lang="en">

<head>
    <title>Sky color experiments</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        canvas {
            display: block;
        }
    </style>
</head>


<body>
    <script src="vendor/spectral.min.js"></script>
    <script>
        function createCanvas(w, h) {
            var canvas = document.createElement('canvas');
            var dpr = window.devicePixelRatio;
            canvas.width = w * dpr;
            canvas.height = h * dpr;
            canvas.style.width = `${w}px`
            canvas.style.height = `${h}px`

            var ctx = canvas.getContext('2d')
            ctx.scale(dpr, dpr)
            ctx.w = w;
            ctx.h = h;
            ctx.dom = canvas;
            return ctx;
        }

        function handleCanvas(title) {
            // 800, 600
            var ctx = createCanvas(400, 300)
            document.body.appendChild(ctx.dom);

            var div = document.createElement('div');
            div.innerHTML = title;
            document.body.appendChild(div);

            return ctx;
        }

        // distinct
        function equalPalette(colors, ctx) {
            ctx.dom.onclick = () => console.log(colors);
            for (let i = 0; i < colors.length; i++) {
                ctx.fillStyle = colors[i];
                ctx.fillRect((i / colors.length) * ctx.w, 0, ctx.w / colors.length, ctx.h);
            }
        }

        // blend
        function blendPalette(colors, ctx) {
            var gradient = ctx.createLinearGradient(0, 0, ctx.w, 0);
            ctx.fillStyle = gradient;
            for (let i = 0; i < colors.length; i++) {
                gradient.addColorStop((i + 0) / (colors.length + 0 - 1), colors[i]);
            }
            ctx.fillRect(0, 0, ctx.w, ctx.h);
        }

        // fork https://observablehq.com/@shan/oklab-color-wheel
        // to rgb, with conversion from linear to srgb
        const oklab = (lab) => {
            const L = lab[0], a = lab[1], b = lab[2]
            const l_ = L + 0.3963377774 * a + 0.2158037573 * b;
            const m_ = L - 0.1055613458 * a - 0.0638541728 * b;
            const s_ = L - 0.0894841775 * a - 1.2914855480 * b;
            const l = l_ * l_ * l_;
            const m = m_ * m_ * m_;
            const s = s_ * s_ * s_;

            return [
                255 * gamma(+4.0767245293 * l - 3.3072168827 * m + 0.2307590544 * s),
                255 * gamma(-1.2681437731 * l + 2.6093323231 * m - 0.3411344290 * s),
                255 * gamma(-0.0041119885 * l - 0.7034763098 * m + 1.7068625689 * s)
            ];
        }

        const rgbToOkLab = c => {
            const r = gamma_inv(c[0] / 255);
            const g = gamma_inv(c[1] / 255);
            const b = gamma_inv(c[2] / 255);
            const l = 0.4121656120 * r + 0.5362752080 * g + 0.0514575653 * b;
            const m = 0.2118591070 * r + 0.6807189584 * g + 0.1074065790 * b;
            const s = 0.0883097947 * r + 0.2818474174 * g + 0.6302613616 * b;

            const l_ = Math.cbrt(l);
            const m_ = Math.cbrt(m);
            const s_ = Math.cbrt(s);

            return [
                0.2104542553 * l_ + 0.7936177850 * m_ - 0.0040720468 * s_,
                1.9779984951 * l_ - 2.4285922050 * m_ + 0.4505937099 * s_,
                0.0259040371 * l_ + 0.7827717662 * m_ - 0.8086757660 * s_
            ]

        }

        // const gamma_inv = x => x
        // const gamma= x => x

        const gamma_inv = x => x >= 0.04045 ? Math.pow((x + 0.055) / (1 + 0.055), 2.4) : x / 12.92
        const gamma = x => (x >= 0.0031308 ? 1.055 * Math.pow(x, 1 / 2.4) - 0.055 : 12.92 * x)
        // const gamma_inv = x => Math.pow(x, 2.2);
        // const gamma = x => Math.pow(x, 1/ 2.2);

        // animate
        function animatePalette(colors, ctx, interval = 800) {
            let i = 0;
            let animate;

            const paint = () => {
                ctx.fillStyle = colors[i];
                ctx.fillRect(0, 0, ctx.w, ctx.h);

                i++;
                i %= colors.length;
            }

            paint();

            ctx.dom.onmouseenter = () => {
                if (!animate) {
                    animate = setInterval(paint, interval)
                }
            }

            ctx.dom.onmouseleave = () => {
                animate = clearInterval(animate)
            }
        }

        function parseHex(str) {
            if (!str.startsWith('#')) return;

            str = str.substring(1)
            if (str.length == 6) {
                return [
                    parseInt(str.substring(0, 2), 16),
                    parseInt(str.substring(2, 4), 16),
                    parseInt(str.substring(4, 6), 16),
                ]
            }
        }

        const blues = [
            '#011f4b',
            '#03396c',
            '#005b96',
            '#6497b1',
            '#b3cde0',
        ]; //https://www.color-hex.com/color-palette/1294

        var ctx = handleCanvas('Shades of blue');
        equalPalette(blues, ctx)

        var ctx = handleCanvas('Shades of blue (blended)');
        blendPalette(blues, ctx)

        // animate
        var ctx = handleCanvas('Animate shades of blue')
        animatePalette(blues, ctx);

        var orange = [
            '#ffb150',
            '#ffa263',
            '#ff9853',
            '#ff855b',
            '#ffbb39',
        ];

        var ctx = handleCanvas('Shades of orange');
        equalPalette(orange, ctx)


        // oklab / spectral mixing
        var palette = spectral.palette('#00357B', '#F0F0F0', 9);
        var ctx = handleCanvas(`spectral palette '#00357B', '#F0F0F0' of 9`);
        equalPalette(palette, ctx)

        var palette = spectral.palette('#00357B', '#F0F0F0', 5);
        var ctx = handleCanvas(`spectral palette '#00357B', '#F0F0F0' of 5`);
        equalPalette(palette, ctx)

        var palette = spectral.palette('#00357B', '#F0F0F0', 3);
        var ctx = handleCanvas(`spectral palette '#00357B', '#F0F0F0' of 3`);
        equalPalette(palette, ctx);

        // animate

        ((ctx) => {
            var ctx = createCanvas(400, 300)
            document.body.appendChild(ctx.dom);

            ctx.dom.onmouseover = () => {
                let i = 0;

                const animate = () => {
                    let color = spectral.mix('rgb(0, 33, 133)', 'rgb(215, 153, 0)', i);

                    ctx.fillStyle = color
                    ctx.fillRect(0, 0, ctx.w, ctx.h);

                    i += 0.1;
                    if (i < 1)
                        setTimeout(animate, 500);
                }

                animate();
            }
        })(ctx);

        var array = [
            '#ED2938',
            '#FF8C01',
            '#FFAA1C',
            '#ffe733',
        ];
        var ctx = handleCanvas('Animate shades')
        animatePalette(array, ctx);

        [
            [
                '#ED2938',
                '#FF8C01',
                '#FFAA1C',
                '#ffe733',
            ],
            [
                '#ff1c05',
                '#ff4405',
                '#ff5405',
                '#ff7805',
                '#ff9505'],
            '#ffd500 #fba31a #f37220 #df1e26'.split(' ') // 941a1c
        ].forEach((array, i) => {
            var ctx = handleCanvas(`Orange shades ${i + 1}`);
            equalPalette(array, ctx)
        })


        const blue_red = [
            '#011f4b',
            // '#00357B',
            '#ED2938'];

        // other blue red
        // // var palette = spectral.palette('rgb(0, 33, 133)', 'rgb(215, 153, 0)', 5);\\
        // '#00357B', '#ff1c05'


        function interpolate(colors, n, k, light) {
            var start = colors[0];
            var end = colors[1];

            var results = [];
            for (let i = 0; i < n; i++) {
                let interpolate = i / (n - 1);
                if (k && (!(light && !(i == 0))) ) interpolate = k(interpolate)
  
                const color = start.map((color, c) => {
                    const r = (end[c] - color) * interpolate + color;
                    return r;
                })

                results.push(color)
            }
            console.log(results);

            return results;
        }

        function asHex(h) {
            const s = '00' + h.toString(16);
            return s.substr(s.length - 2)
        }

        function toRgb(color) {
            const r = asHex(color[0] | 0);
            const g = asHex(color[1] | 0);
            const b = asHex(color[2] | 0);
            return `#${r}${g}${b}`
            return `rgb(${color[0]} ${color[1]} ${color[2]}`
        }

        var divisions = 10;
        // const cubic = (i) => 1 - i;
        const cubic = (i) => i * i * i
        // const cubic = (i) => i * i * (2 - i)
        //https://iquilezles.org/articles/functions/
        const curve = (i) => i * i * (2 - i)
        const smoothstep = x => x * x * (3 - 2 * x)

        const smootherstep = x => x * x * x * (x * (6.0 * x - 15.0) + 10.0);

        var linear_blue_red = interpolate(blue_red.map(parseHex), divisions).map(toRgb);

        var lab = blue_red.map(parseHex).map(rgbToOkLab);
        var oklab_blue_red = interpolate(lab, divisions).map(oklab).map(toRgb);
        // var oklab_blue_red = interpolate(lab.map(oklab), divisions).map(toRgb); // sanity check!


        var spectral_blue_red = spectral.palette(...blue_red, divisions)

        var ctx = handleCanvas(`Blue Red OkLab (animate)`);
        animatePalette(oklab_blue_red, ctx, 600)
        var ctx = handleCanvas(`Blue Red Linear (animate)`);
        animatePalette(linear_blue_red, ctx, 600)
        var ctx = handleCanvas(`Blue Red Spectral (animate)`);
        animatePalette(spectral_blue_red, ctx, 600)



        var ctx = handleCanvas(`Blue Red OkLab`);
        equalPalette(oklab_blue_red, ctx)
        var ctx = handleCanvas(`Blue Red Linear`);
        equalPalette(linear_blue_red, ctx)
        var ctx = handleCanvas(`Blue Red Spectral`);
        equalPalette(spectral_blue_red, ctx)

            // blend
            ;[
                blue_red, // Blend 1 canvas interpolation
                spectral_blue_red, // spectral

                '#ffd500 #fba31a #f37220 #df1e26'.split(' '),
                '#ffd500 #df1e26'.split(' '),
            ].forEach((array, i) => {
                var ctx = handleCanvas(`Blends ${i + 1}`);
                blendPalette(array, ctx)
            });

        const yellow_red = '#ffd500 #df1e26'.split(' ')
        var modifier = smoothstep;

        var linear_yellow_red = interpolate(yellow_red.map(parseHex), divisions, modifier).map(toRgb);
        var lab = yellow_red.map(parseHex).map(rgbToOkLab);
        var oklab_yellow_red = interpolate(lab, divisions, modifier).map(oklab).map(toRgb);
        var spectral_yellow_red = spectral.palette(...yellow_red, divisions)

        var ctx = handleCanvas(`Yellow Red OkLab (animate)`);
        animatePalette(oklab_yellow_red, ctx, 400)
        var ctx = handleCanvas(`Yellow Red Linear (animate)`);
        animatePalette(linear_yellow_red, ctx, 400)
        var ctx = handleCanvas(`Yellow Red Spectral (animate)`);
        animatePalette(spectral_yellow_red, ctx, 400)

        var ctx = handleCanvas(`Yellow Red OkLab`);
        equalPalette(oklab_yellow_red, ctx)
        var ctx = handleCanvas(`Yellow Red Linear`);
        equalPalette(linear_yellow_red, ctx)
        var ctx = handleCanvas(`Yellow Red Spectral`);
        equalPalette(spectral_yellow_red, ctx)

        // var modifier = (x) => 1 - (1 - x) * (1 - x);
        // var modifier = (x) => x * x;
        // modifier = null
        const blue_white = '#10109b #ffffff'.split(' ') // 011f4b 00004b | 10109b #5f5f5f | 1010f0 #efefef
        var linear_blue_white = interpolate(blue_white.map(parseHex), divisions, modifier).map(toRgb);
        var lab = blue_white.map(parseHex).map(rgbToOkLab);
        var oklab_blue_white = interpolate(lab, divisions, modifier, true).map(oklab).map(toRgb);
        var spectral_blue_white = spectral.palette(...blue_white, divisions)
        var ctx = handleCanvas(`Blue white OkLab`);
        equalPalette(oklab_blue_white, ctx)
        var ctx = handleCanvas(`Blue white Linear`);
        equalPalette(linear_blue_white, ctx)
        var ctx = handleCanvas(`Blue white Spectral`);
        equalPalette(spectral_blue_white, ctx)

        // const darkish_blues = '#2a58ce #07173e'.split(' ') // 011f4b 00004b | 10109b #5f5f5f | 1010f0 #efefef
        const darkish_blues = '#07173e #ffffff'.split(' ') // 011f4b 00004b | 10109b #5f5f5f | 1010f0 #efefef
        var linear_darkish_blues = interpolate(darkish_blues.map(parseHex), 8, modifier).map(toRgb);
        var lab = darkish_blues.map(parseHex).map(rgbToOkLab);
        var oklab_darkish_blues = interpolate(lab, 8, modifier, true).map(oklab).map(toRgb);
        var spectral_darkish_blues = spectral.palette(...darkish_blues, 8)
        var ctx = handleCanvas(`Darksih blues OkLab`);
        equalPalette(oklab_darkish_blues, ctx)
        var ctx = handleCanvas(`Darksih blues Linear`);
        equalPalette(linear_darkish_blues, ctx)
        var ctx = handleCanvas(`Darksih blues Spectral`);
        equalPalette(spectral_darkish_blues, ctx)



    </script>
</body>

</html>